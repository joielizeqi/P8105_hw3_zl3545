---
title: "P8105 HW3"
author: "Zeqi Li"
date: "2024-10-14"
output: github_document
---

```{r setup, include = FALSE}
library(p8105.datasets)
library(tidyverse)
library(ggridges)
library(patchwork)
```

# Problem 1 
## Load dataset
```{r load_data_p1}
data("ny_noaa")
head(ny_noaa)
```

The NY NOAA dataset contains `r nrow(ny_noaa)` rows and `r nrow(ny_noaa)` 
columns. This dataset describes the weather in New York using variables such 
as date of observation, precipitation, snowfall, snow depth, max temperature, 
and min temperature.

## Question 1
```{r p1q1_tidy}
ny_noaa =
  ny_noaa |> 
  mutate(tmax = as.numeric(tmax),
         tmin = as.numeric(tmin)) |> 
  separate(date, into = c("year", "month", "day"), convert = TRUE)
```

To tidy up the dataset, `mutate()` is first applied to convert the `tmax` and 
`tmin` from `chr` data type to `num` data type. Then, `separate()` is applied 
to split the `date` variable into `year`, `month`, and `day` columns.

```{r p1q1_snow}
snow_count = 
  ny_noaa |> 
    count(snow) |> 
    arrange(desc(n))
```

The most common values in the snowfall column is zero-es. There are 
`r pull(snow_count, n)[1]` zero-es in that column, mainly because there are 
many days in a year when there is no snow in New York. Another noticeable 
common value is the NAs.  There are `r pull(snow_count, n)[2]` NA values in 
the snowfall column. 

## Question 2
```{r p1q2, message = FALSE, warning = FALSE}
ny_noaa |> 
  group_by(id, year, month) |> 
  filter(month %in% c(1, 7)) |> 
  summarize(mean_tmax = mean(tmax, 
                             na.rm = TRUE,
                             color = id)) |> 
  ggplot(aes(x = year,
             y = mean_tmax,
             group = id)) +
  geom_point() +
  geom_path() +
  facet_grid(~ month) +
  labs(title = "Mean Max Temperatures for Weather Stations in New York in Janurary and July across years")
```

Overall, we can see that the average max temperatures in July are higher than 
those in January, as expected. The max temperatures in all stations fluctuate 
in the same stable range across the years, as we can clearly see all the lines 
following the same trend of up and downs. 

There are also a few outliers. For example, in the plot for January, there were
observations below -100 F in 1982, 1994, and 2004; in the plot for July, there 
were sobservations below 150 F in 1988, 2004, and 2007.

## Question 3
```{r p1q3, message = FALSE, warning = FALSE}
hex = 
  ny_noaa |> 
  ggplot(aes(x = tmin,
             y = tmax)) +
  geom_hex()

ridge = 
  ny_noaa |> 
  filter(snow > 0, snow < 100) |> 
  ggplot(aes(x = snow,
             y = as.factor(year))) +
  geom_density_ridges() + 
  ylab("year") +
  theme(legend.position = "bottom") +
  viridis::scale_color_viridis(discrete = TRUE)

hex + ridge
```
On the graph above, the plot on the left shows a hex plot of max temperature 
versus min temperature. Hexagons with lighter colors indicate that those areas 
on the plot have more data, and hexagons with darker colors indicate that those 
areas have less amount of data. In general, we can see that most data cluster 
at the center of the plot, and `tmax` and `tmin` follows a roughly directly proportional relationship.

The plot of the right shows a ridge plot of distributions of snowfall over the 
years, for snowfall amount greater than 0 and less than 100. In general, 
snowfall amounts follow a multi-modal distribution, where the amounts peak at 
around 10, 25, 50, and slightly at 75. This multi-modality is likely because of 
the conversion of measurements from the imperial system to the metric system.
